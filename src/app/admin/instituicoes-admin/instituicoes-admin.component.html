<div class="app-container">
  <!-- Sidebar -->
  <nav class="custom-sidebar" [class.collapsed]="!sidebarOpen" aria-label="Navegação admin">
    <div class="cabeca">
      <span class="logo-text">{{ adminNome }}</span>
      <button type="button" class="btn-toggle" (click)="toggleSidebar()" aria-label="Alternar menu">
        <i class="pi pi-bars"></i>
      </button>
    </div>
    <div class="corpo">
      <ul class="menu-list">
        <li *ngFor="let item of sidebarItems; trackBy: trackByIndex">
          <a
            [routerLink]="item.route"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            (click)="item.label === 'Sair' ? sair() : null"
          >
            <i [class]="item.icon"></i>
            <span class="menu-label">{{ item.label }}</span>
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main -->
  <main class="main-content" [ngClass]="{ 'expanded': !sidebarOpen }">
    <div class="topbar-inline">
      <div class="brand">
        <span class="logo">CEUB</span>
        <span class="title">Admin • Instituições</span>
      </div>
    </div>

    <main class="content">
      <h1 class="page-title">Instituições</h1>
      <p class="page-subtitle">Monitore e gerencie as instituições cadastradas</p>

      <!-- KPIs + Gráfico -->
      <section class="kpis">
        <div class="kpi">
          <span class="kpi-title">Total</span>
          <strong class="kpi-value">{{ total }}</strong>
        </div>
        <div class="kpi">
          <span class="kpi-title">Ativas</span>
          <strong class="kpi-value">{{ totalAtivas }}</strong>
        </div>
        <div class="kpi">
          <span class="kpi-title">Pendentes</span>
          <strong class="kpi-value">{{ totalPendentes }}</strong>
        </div>
        <div class="kpi">
          <span class="kpi-title">Inativas</span>
          <strong class="kpi-value">{{ totalInativas }}</strong>
        </div>

        <div class="chart-card">
          <p-chart type="doughnut" [data]="statusChartData" [options]="statusChartOptions"></p-chart>
        </div>
      </section>

      <!-- Filtros -->
      <section class="filters">
        <input
          pInputText
          type="text"
          placeholder="Buscar por nome, e-mail, CNPJ, cidade, área..."
          [(ngModel)]="busca"
          (ngModelChange)="aplicarFiltros()"
          class="w-100"
        />

        <div class="filter-row">
          <p-dropdown
            [options]="areas"
            [showClear]="true"
            [(ngModel)]="areaSelecionada"
            (onChange)="aplicarFiltros()"
            [style]="{ width: '220px' }"
            placeholder="Filtrar área">
          </p-dropdown>

          <p-dropdown
            [options]="statusOptions"
            [showClear]="true"
            [(ngModel)]="statusSelecionado"
            (onChange)="aplicarFiltros()"
            [style]="{ width: '180px' }"
            placeholder="Status">
          </p-dropdown>

          <p-dropdown
            [options]="cidades"
            [showClear]="true"
            [(ngModel)]="cidadeSelecionada"
            (onChange)="aplicarFiltros()"
            [style]="{ width: '200px' }"
            placeholder="Cidade">
          </p-dropdown>
        </div>
      </section>

      <!-- Tabela -->
      <section class="table-wrap">
        <p-table
          [value]="pagina"
          [tableStyle]="{ 'min-width': '64rem' }"
          responsiveLayout="scroll">

          <ng-template pTemplate="header">
            <tr>
              <th>Instituição</th>
              <th>E-mail</th>
              <th>CNPJ</th>
              <th>Cidade</th>
              <th>Área</th>
              <th>Status</th>
              <th>Vagas Abertas</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-i>
            <tr>
              <td><b>{{ i.nome }}</b></td>
              <td>{{ i.email }}</td>
              <td>{{ i.cnpj }}</td>
              <td>{{ i.cidade }}</td>
              <td>{{ i.area }}</td>
              <td>
                <p-tag [severity]="getSeverity(i.status)" [value]="i.status"></p-tag>
              </td>
              <td>{{ i.vagasAbertas }}</td>
            </tr>
          </ng-template>
        </p-table>

        <p-paginator
          [rows]="rows"
          [totalRecords]="filtradas.length"
          [first]="page * rows"
          (onPageChange)="onPageChange($event)"
          [rowsPerPageOptions]="[6,10,20]"
          styleClass="mt-2">
        </p-paginator>
      </section>
    </main>
